<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Card</title>

    <!--Bootstrap-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">

    <!--Axios-->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <!--Font Awesome-->
    <script src="https://kit.fontawesome.com/c0f63a9145.js" crossorigin="anonymous"></script>

    <!--Vue-->
    <script src="https://unpkg.com/vue@next"></script>
    <style>
        html {
            scroll-behavior :smooth;
        }
        body {
            background-image: url("bg3.png");
            background-repeat: no-repeat;
            background-size: cover;
            background-attachment: fixed;
        }

        .cardbod {
            background-color:rgb(226, 249, 226);
        }

        #map {
            height: 400px;
            /* The height is 400 pixels */
            width: 100%;
            /* The width is the width of the web page */
        }

        /* Optional: Makes the sample page fill the window. */
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

    </style>
    

</head>
<body>
    <div id="map"></div>
    <div class="card mx-auto my-5 cardbod p-2 text-dark" style="width: 50%;">
        <img id="food-card" src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/33/Espaguetis_carbonara.jpg/1200px-Espaguetis_carbonara.jpg" class="card-img-top" alt="food-card-img">
        <div class="card-body">
          <h5 class="card-title" id="card-title">Spaghetti Carbonara</h5>
          <p class="card-text" id="card-text">
            <div><span class="fw-bold">Diet type: </span><span id="diet-type">Meat <i class="fa-solid fa-cow"></i></span></div>
            <div><span class="fw-bold">Ingredients <i class="fa-solid fa-bowl-food"></i> : </span>
                <br> 
                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Eos fuga voluptatem id! Cumque tenetur suscipit tempora dolor praesentium, voluptatibus fugiat, recusandae odio consectetur ipsa atque molestias quidem, quam unde facere!
                </p>
                <span id="ingredients"></span>
            </div>
            <div><span class="fw-bold">Instructions <i class="fa-solid fa-pen-to-square"></i> : </span>
                <br>
                <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eaque, iure nobis tempora minima optio quaerat. Delectus, modi et ut aperiam quaerat quod magnam dolorum dicta iusto, totam officia suscipit nihil.
                </p>
                <div id="instructions"></div>
            </div>
            <div><span class="fw-bold"> Time Taken <i class="fa-solid fa-clock"></i> : </span>100min
                <div id="time-taken"></div>
            </div>
            <br>
            <br>
            <br>
            <a type="button" class="btn btn-success" id="get-nutrition">Get Nutritional Analysis</a>
            <br>
            <div class="float-start" style="display: none; background-color:rgb(217, 255, 217); color:black;" id="nutritional-analysis" >
                <br>
                <a href="#get-nutrition" class="text-dark text-decoration-none ms-3"></a>
                <!--how to make it auto scroll down-->
                <div id="chart">
                </div>
            </div>
            <button type="button" class="btn btn-success" id="getmap"> Show Map </button>
            
            <div id="hbb"></div>
            <button type="button" class="btn btn-success float-end">Buy</button>

          </p>
          
        </div>
      </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>

    <!-- ChartJS -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <script>
        let diets, urlInfo, urlNutrition, calories, fat, protein, carbs, analysis, urlMap, keyMap;
        var lat = "1.2973784";
        var lng = "103.8495219";

        var nutritionAnalysis = document.getElementById("nutritional-analysis");
        var getNutrition = document.getElementById("get-nutrition");
        getNutrition.addEventListener("click", getNutritionAnalysis);

        var getMap = document.getElementById("getmap");
        getMap.addEventListener("click", showMap);

        function getInformation() {
            urlInfo = "https://api.spoonacular.com/recipes/analyze?apiKey=9540bce016ee479e87f5f7d88feba48e"
            axios.post(urlInfo, {
                "language": "en",
                "includeNutrition": true,
                "includeTaste": true,
                "title": "Spaghetti Carbonara",
                "servings": 2,
                "ingredients": [
                    "1 lb spaghetti",
                    "3.5 oz pancetta",
                    "2 Tbsps olive oil",
                    "1  egg",
                    "0.5 cup parmesan cheese"
                ],
                "instructions": "Bring a large pot of water to a boil and season generously with salt. Add the pasta to the water once boiling and cook until al dente. Reserve 2 cups of cooking water and drain the pasta. "
            })
                .then(response => {
                    // console.log(response.data);
                    console.log(response.data);
                    var obj = response.data;
                    diets = response.data.diets;  // ask whether can remove the diets input when listing foods, so we will ownself analyse the recipe to see which diet
                    // id, foodname, price, hasRecipe, instructions, ingredients

                })
                .catch( error => {
                    console.log(error.message);
                });
        };

        function getNutritionAnalysis() {
            urlNutrition = "https://api.spoonacular.com/recipes/guessNutrition?apiKey=9540bce016ee479e87f5f7d88feba48e";
            axios.get(urlNutrition, {
                params: {
                    title:  "Butter Chicken"
                }
            })
                .then(response => {
                    // console.log(response.data);
                    console.log(response.data);
                    var obj = response.data;
                    calories = obj.calories.value;
                    fat = obj.fat.value;
                    protein = obj.protein.value;
                    carbs = obj.carbs.value;

                    calories = calories * 0.129598;
                    showAnalysis(calories, fat, protein, carbs);

                })
                .catch( error => {
                    console.log(error.message);
                });
        }


        function showAnalysis(calories, fat, protein, carbs) {
            analysis = document.getElementById("nutritional-analysis");
            analysis.style.display = "block";

            var options = {
                series: [{
                name: 'Series 1',
                data: [calories, fat, protein, carbs],
                }],
                chart: {
                height: 350,
                type: 'radar',
                },
                title: {
                text: 'Nutrition Chart'
                },
                xaxis: {
                categories: ['Calories', 'Fat', 'Protein', 'Carbs']
                }
            };

            var chart = new ApexCharts(document.querySelector("#chart"), options);
            chart.render();
        }

        function showMap() {

            let addr = "Singapore Management University";
            
            keyMap = "AIzaSyBr_1j_A_JjyD9ut5tQnmCyXjcYUJVqBmk";
            urlMap = "https://maps.googleapis.com/maps/api/geocode/json?";

            axios.get(urlMap, {
                params: {
                    address:  addr,
                    key: keyMap
                }
            })
            .then(response => {
                console.log(response.data);
                let fullAddress = response.data.results[0].formatted_address;
                lat = response.data.results[0].geometry.location.lat;
                lng = response.data.results[0].geometry.location.lng;

                initMap();
            })
            .catch( error => {
                console.log(error.message);
                
            });

        }

        function initMap() {

            // ADD CODE HERE
            // The location of SMU
            console.log("yes");
            lat = parseFloat(lat);
            lng = parseFloat(lng);
            console.log(lat, lng);

            const SMU = { lat: lat, lng: lng };
            console.log(SMU);
            const map = new google.maps.Map(document.getElementById("map"), { 
                zoom: 16,
                center: SMU,
            });
            console.log(map);
            // marker
            const marker = new google.maps.Marker({
                position: SMU,
                map: map
            })

        }
            window.initMap = initMap;

    </script>
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBr_1j_A_JjyD9ut5tQnmCyXjcYUJVqBmk&callback=initMap&v=weekly"
        defer
    ></script>
</body>
</html>